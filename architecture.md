# ScaleShort Architecture

## System Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Client (Browser)                                │
│                                                                             │
│                         React + Vite + TailwindCSS                          │
└─────────────────────────────────┬───────────────────────────────────────────┘
                                  │
                                  │ HTTP Request
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Spring Boot Application                            │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         REST Controller                              │   │
│  │                                                                      │   │
│  │   POST /api/v1/urls     →  Create short URL                         │   │
│  │   GET  /api/v1/urls/{code} →  Get original URL                      │   │
│  │   GET  /r/{code}        →  Redirect to original URL                 │   │
│  └──────────────────────────────────┬──────────────────────────────────┘   │
│                                     │                                       │
│  ┌──────────────────────────────────▼──────────────────────────────────┐   │
│  │                         Service Layer                                │   │
│  │                                                                      │   │
│  │   ┌─────────────────┐    ┌─────────────────┐                        │   │
│  │   │ UrlShortener    │    │ CodeGenerator   │                        │   │
│  │   │ Service         │───▶│ (SHA-256 Hash)  │                        │   │
│  │   └────────┬────────┘    └─────────────────┘                        │   │
│  │            │                                                         │   │
│  └────────────┼─────────────────────────────────────────────────────────┘   │
│               │                                                             │
│  ┌────────────▼─────────────────────────────────────────────────────────┐   │
│  │                         Caching Layer                                │   │
│  │                                                                      │   │
│  │   ┌─────────────────────────────────────────────────────────────┐   │   │
│  │   │                    L1: Caffeine Cache                        │   │   │
│  │   │                    (In-Memory, 10K entries, 10min TTL)       │   │   │
│  │   └─────────────────────────────┬───────────────────────────────┘   │   │
│  │                                 │ Cache Miss                         │   │
│  │                                 ▼                                    │   │
│  │   ┌─────────────────────────────────────────────────────────────┐   │   │
│  │   │                    L2: Redis                                 │   │   │
│  │   │                    (Distributed, 30-day TTL)                 │   │   │
│  │   └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                  │
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Redis Storage                                   │
│                                                                             │
│   ┌───────────────────────────┐    ┌───────────────────────────┐           │
│   │   c:{code} → {url}        │    │   u:{url} → {code}        │           │
│   │   (Code to URL mapping)   │    │   (URL to Code mapping)   │           │
│   │                           │    │   (Reverse Index)         │           │
│   └───────────────────────────┘    └───────────────────────────┘           │
│                                                                             │
│                    Both with TTL (default 30 days)                          │
│                    AOF persistence enabled                                  │
└─────────────────────────────────────────────────────────────────────────────┘
```

## URL Shortening Flow

```
┌──────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────┐
│  Client  │     │  Controller │     │   Service   │     │  Redis  │
└────┬─────┘     └──────┬──────┘     └──────┬──────┘     └────┬────┘
     │                  │                   │                  │
     │ POST /api/v1/urls│                   │                  │
     │ {longUrl: "..."} │                   │                  │
     │─────────────────▶│                   │                  │
     │                  │                   │                  │
     │                  │ createShortUrl()  │                  │
     │                  │──────────────────▶│                  │
     │                  │                   │                  │
     │                  │                   │ 1. Check if URL  │
     │                  │                   │    already exists│
     │                  │                   │─────────────────▶│
     │                  │                   │                  │
     │                  │                   │◀─────────────────│
     │                  │                   │                  │
     │                  │                   │ 2. If not exists:│
     │                  │                   │    hash(URL) →   │
     │                  │                   │    6-char code   │
     │                  │                   │                  │
     │                  │                   │ 3. Save mapping  │
     │                  │                   │    c:code → url  │
     │                  │                   │    u:url → code  │
     │                  │                   │─────────────────▶│
     │                  │                   │                  │
     │                  │◀──────────────────│                  │
     │                  │                   │                  │
     │ {code, shortUrl} │                   │                  │
     │◀─────────────────│                   │                  │
     │                  │                   │                  │
```

## URL Redirect Flow

```
┌──────────┐     ┌─────────────┐     ┌─────────────┐     ┌──────────┐     ┌─────────┐
│  Client  │     │  Controller │     │   Service   │     │ Caffeine │     │  Redis  │
└────┬─────┘     └──────┬──────┘     └──────┬──────┘     └────┬─────┘     └────┬────┘
     │                  │                   │                  │                │
     │ GET /r/{code}    │                   │                  │                │
     │─────────────────▶│                   │                  │                │
     │                  │                   │                  │                │
     │                  │ getUrl(code)      │                  │                │
     │                  │──────────────────▶│                  │                │
     │                  │                   │                  │                │
     │                  │                   │ 1. Check L1      │                │
     │                  │                   │─────────────────▶│                │
     │                  │                   │                  │                │
     │                  │                   │   Cache Hit?     │                │
     │                  │                   │◀─────────────────│                │
     │                  │                   │                  │                │
     │                  │                   │ 2. If miss,      │                │
     │                  │                   │    check L2      │                │
     │                  │                   │─────────────────────────────────▶│
     │                  │                   │                  │                │
     │                  │                   │◀─────────────────────────────────│
     │                  │                   │                  │                │
     │                  │◀──────────────────│                  │                │
     │                  │                   │                  │                │
     │ 302 Redirect     │                   │                  │                │
     │◀─────────────────│                   │                  │                │
     │                  │                   │                  │                │
```

## Hash Collision Handling

```
┌─────────────────────────────────────────────────────────────────┐
│                    URL Shortening Algorithm                      │
└─────────────────────────────────────────────────────────────────┘

Input: "https://example.com/very/long/url"
                    │
                    ▼
        ┌───────────────────────┐
        │   SHA-256 Hash        │
        │   Take first 6 bytes  │
        │   Convert to Base62   │
        └───────────┬───────────┘
                    │
                    ▼
              code = "abc123"
                    │
                    ▼
        ┌───────────────────────┐
        │   Try save to Redis   │
        │   SET NX (if not      │
        │   exists)             │
        └───────────┬───────────┘
                    │
           ┌────────┴────────┐
           │                 │
        Success           Collision
           │                 │
           ▼                 ▼
        Done         ┌───────────────────┐
                     │ Add salt & retry  │
                     │ hash(url + "#1")  │
                     │ hash(url + "#2")  │
                     │ ...               │
                     └───────────────────┘
```

## Tech Stack

```
┌─────────────────────────────────────────────────────────────────┐
│                         Frontend                                 │
├─────────────────────────────────────────────────────────────────┤
│  React 18        │  UI Framework                                │
│  Vite            │  Build Tool                                  │
│  TailwindCSS     │  Styling                                     │
│  shadcn/ui       │  Component Library                           │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                         Backend                                  │
├─────────────────────────────────────────────────────────────────┤
│  Java 17         │  Language                                    │
│  Spring Boot 3.2 │  Framework                                   │
│  Caffeine        │  L1 Cache (In-Memory)                        │
│  Lettuce         │  Redis Client                                │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                         Storage                                  │
├─────────────────────────────────────────────────────────────────┤
│  Redis           │  Primary Data Store                          │
│  AOF             │  Persistence (Append Only File)              │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                         Deployment                               │
├─────────────────────────────────────────────────────────────────┤
│  Docker          │  Containerization                            │
│  Azure Container │  Cloud Platform                              │
│  Apps            │                                              │
└─────────────────────────────────────────────────────────────────┘
```

## Performance

```
┌─────────────────────────────────────────────────────────────────┐
│                      Performance Metrics                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   Read (Redirect):                                              │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │  L1 Hit:    < 1ms   (Caffeine in-memory)                │   │
│   │  L2 Hit:    ~ 5ms   (Redis network call)                │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                  │
│   Write (Create):                                               │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │  New URL:   ~ 10ms  (Hash + Redis write)                │   │
│   │  Existing:  ~ 5ms   (Redis lookup only)                 │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                  │
│   Capacity:                                                     │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │  6-char Base62 = 62^6 = 56.8 billion unique codes       │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```
